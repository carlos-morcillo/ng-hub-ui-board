@if (columns().length) {
<div class="hub-board__drop-list" (dragover)="onBoardDragOver($event)" (drop)="onBoardDrop($event)">
	<div class="hub-board__columns">
		@for (column of columns(); let index = $index; track trackColumnById($index, column)) {
		<!-- Column placeholder (before column) -->
		@if (shouldShowColumnDropIndicator(index)) {
		<div class="hub-board__column-placeholder">
			@if (columnPlaceholderTpt()) {
			<ng-container
				[ngTemplateOutlet]="columnPlaceholderTpt()!"
				[ngTemplateOutletContext]="{ column: draggedColumn }"
			></ng-container>
			}
		</div>
		}
		<div
			class="hub-board__column-container"
			[class.hub-board__column-container--disabled]="column.disabled"
			[class.hub-board__column-container--dragging-ghost]="isDraggingColumn(column) && dragBehavior() === 'ghost'"
			[class.hub-board__column-container--dragging-hide]="isDraggingColumn(column) && dragBehavior() === 'hide'"
			[class.hub-board__column-container--dragging-collapse]="isDraggingColumn(column) && dragBehavior() === 'collapse'"
			[attr.draggable]="!columnSortingDisabled() && !column.disabled"
			[attr.data-column-index]="index"
			(dragstart)="onColumnDragStart($event, column, index)"
			(dragend)="onColumnDragEnd($event)"
		>
			<div class="hub-board__column" [ngClass]="column.classlist" [ngStyle]="column.style">
				<div class="hub-board__column-header">
					<ng-container
						[ngTemplateOutlet]="columnHeaderTpt() || defaultColumnHeaderTpt"
						[ngTemplateOutletContext]="{ column: column }"
					>
					</ng-container>
				</div>
				<div
					class="hub-board__column-body"
					[class.hub-board__column-body--drag-over]="hoveredColumnIndex() === index"
					(scroll)="onScroll(index, $event)"
					(dragover)="onCardDragOver($event, column, index)"
					(dragleave)="onCardDragLeave($event, index)"
					(drop)="onCardDrop($event, column, index)"
				>
					@for (card of column.cards; let cardIndex = $index; track card) {
					<!-- Card placeholder (before card) -->
					@if (shouldShowCardDropIndicator(index, cardIndex)) {
					<div class="hub-board__card-placeholder">
						@if (cardPlaceholderTpt()) {
						<ng-container
							[ngTemplateOutlet]="cardPlaceholderTpt()!"
							[ngTemplateOutletContext]="{ card: draggedCard, column: column }"
						></ng-container>
						}
					</div>
					}
					<div
						class="hub-board__card"
						[class.hub-board__card--disabled]="card.disabled"
						[class.hub-board__card--dragging-ghost]="isDraggingCard(card) && dragBehavior() === 'ghost'"
						[class.hub-board__card--dragging-hide]="isDraggingCard(card) && dragBehavior() === 'hide'"
						[class.hub-board__card--dragging-collapse]="isDraggingCard(card) && dragBehavior() === 'collapse'"
						[attr.draggable]="!card.disabled && !column.cardSortingDisabled"
						(dragstart)="onCardDragStart($event, card, index, cardIndex)"
						(dragend)="onCardDragEnd($event)"
						(click)="cardClick(card)"
						(mousedown)="card.disabled && $event.stopPropagation()"
						[ngClass]="card.classlist"
						[ngStyle]="card.style"
					>
						<div class="hub-board__card-body">
							<ng-container
								[ngTemplateOutlet]="cardTpt() || defaultCardTpt"
								[ngTemplateOutletContext]="{
									item: card,
									column
								}"
							>
							</ng-container>
						</div>
					</div>
					}
					<!-- Card placeholder at the end -->
					@if (shouldShowCardDropIndicator(index, column.cards.length)) {
					<div class="hub-board__card-placeholder">
						@if (cardPlaceholderTpt()) {
						<ng-container
							[ngTemplateOutlet]="cardPlaceholderTpt()!"
							[ngTemplateOutletContext]="{ card: draggedCard, column: column }"
						></ng-container>
						}
					</div>
					}
				</div>

				@if (columnFooterTpt()) {
				<div class="hub-board__column-footer">
					<ng-container
						[ngTemplateOutlet]="columnFooterTpt() ?? null"
						[ngTemplateOutletContext]="{
							column: column
						}"
					>
					</ng-container>
				</div>
				}
			</div>
		</div>
		}
		<!-- Column placeholder at the end -->
		@if (shouldShowColumnDropIndicator(columns().length)) {
		<div class="hub-board__column-placeholder">
			@if (columnPlaceholderTpt()) {
			<ng-container
				[ngTemplateOutlet]="columnPlaceholderTpt()!"
				[ngTemplateOutletContext]="{ column: draggedColumn }"
			></ng-container>
			}
		</div>
		}
	</div>
</div>
}

<ng-template #defaultCardTpt let-item="item">
	<h6 class="hub-board__card-title">{{ item.title }}</h6>
	<p class="hub-board__card-subtitle">{{ item.description }}</p>
</ng-template>

<ng-template #defaultColumnHeaderTpt let-column="column">
	<div class="d-flex flex-column">
		<h5 class="hub-board__column-header-title">
			{{ column.title }}
		</h5>
		<h6 class="hub-board__column-header-subtitle">
			{{ column.description }}
		</h6>
	</div>
</ng-template>

<!-- Hidden container for rendering drag preview elements -->
<div #dragPreviewContainer class="hub-board__drag-preview-container" aria-hidden="true"></div>
